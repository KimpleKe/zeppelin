{"paragraphs":[{"text":"\nimport org.apache.spark.sql._\n\ndef loadDF(path:String)={\n    val df = spark.read.option(\"header\",\"true\").csv(s\"${path}\")\n    df.cache\n    df.printSchema\n    println(df.count)\n    println(df.first)\n    df \n}\n\nval reportBasePath = \"s3://rea-consumer-data-qa/ben-kuai/seg-training/\"\n\ndef loadReport(report:String)= loadDF(s\"${reportBasePath}${report}/\")\n\ndef joinDF(df1:DataFrame, df2:DataFrame, column1:String, column2:String)={\n  val joinCondition = if (column1.toLowerCase == column2.toLowerCase) Seq(column1) else Seq(column1, column2) \n   val joinedDF = df1.join(df2, joinCondition)\n    joinedDF.printSchema\n    println(joinedDF.count)\n    println(joinedDF.first)\n    joinedDF\n}\n\nval labelDF = loadDF(\"s3://rea-consumer-data/ben-kuai/app_model_training.csv\")\n\nval outputBasePath = \"s3://rea-consumer-data-qa/ben-kuai/filtered/\"\n\n\n\ndef exportDF(df:DataFrame, path:String)={\n    df.write.option(\"header\",\"true\").csv(path)\n}\n\ndef exportReportDF(df:DataFrame, path:String) = exportDF(df, s\"${outputBasePath}${path}/\")\n\ndef filterReport(report:String)={\n    val reportVisitorIDHeader = \"Visitor_ID\"\n    val labelVisitorIDHeader = \"visitor_id\"\n    val reportDF = loadReport(report)\n    val joinedBasicDF = joinDF(reportDF, labelDF, reportVisitorIDHeader, labelVisitorIDHeader)\n\n    exportReportDF(joinedBasicDF, report)\n\n}\n","dateUpdated":"2016-12-14T23:47:13+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481755239837_1581348240","id":"20161214-021904_770274371","dateCreated":"2016-12-14T22:40:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:131","dateFinished":"2016-12-14T23:39:51+0000","dateStarted":"2016-12-14T23:39:48+0000","focus":true},{"text":"\nfilterReport(\"mobappbasic\")","dateUpdated":"2016-12-14T23:44:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481755239839_1582117738","id":"20161214-022835_1549753088","dateCreated":"2016-12-14T22:40:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:132","dateFinished":"2016-12-14T23:52:02+0000","dateStarted":"2016-12-14T23:44:14+0000","focus":true},{"text":"filterReport(\"mobappproperty\")","dateUpdated":"2016-12-14T23:44:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481755239840_1567882029","id":"20161214-023250_1135918832","dateCreated":"2016-12-14T22:40:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:133","dateFinished":"2016-12-15T00:23:42+0000","dateStarted":"2016-12-14T23:44:23+0000","focus":true},{"text":"filterReport(\"mobapp_search_order\")","dateUpdated":"2016-12-14T23:44:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481755239840_1567882029","id":"20161214-023725_1909797873","dateCreated":"2016-12-14T22:40:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:134","dateFinished":"2016-12-15T00:24:33+0000","dateStarted":"2016-12-14T23:52:02+0000","focus":true},{"text":"filterReport(\"mobapp_search_refine\")","dateUpdated":"2016-12-14T23:39:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481755239840_1567882029","id":"20161214-024248_214336164","dateCreated":"2016-12-14T22:40:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:135","dateFinished":"2016-12-14T23:40:10+0000","dateStarted":"2016-12-14T23:39:57+0000","focus":true},{"text":"%spark.sql\n","dateUpdated":"2016-12-15T00:12:22+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481755239842_1568651526","id":"20161214-040525_1953327874","dateCreated":"2016-12-14T22:40:39+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138","focus":true}],"name":"filter_report","id":"2C3AR8RJB","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}
